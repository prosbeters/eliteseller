<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JagoJualan.PRO Elite Edition | The Seller's Handbook</title>
    <!-- Scripts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAYjVPWSlY3I8DS9VTp28MrSDyva2Xj4N0",
            authDomain: "eliteseller-527fc.firebaseapp.com",
            projectId: "eliteseller-527fc",
            storageBucket: "eliteseller-527fc.firebasestorage.app",
            messagingSenderId: "179141358448",
            appId: "1:179141358448:web:f4b2260bbc88a2adaed5b5"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        window.firebaseAuth = { auth, signInWithEmailAndPassword, signOut };
    </script>

    <style>
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: #FDFDFF;
            scroll-behavior: smooth;
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .animate-in { animation: fade-in-up 0.8s cubic-bezier(0.19, 1, 0.22, 1) forwards; }
        @keyframes fade-in-up {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .text-justify { text-align: justify; text-justify: inter-word; }

        /* Handbook Typography - Pure Narrative Luxury */
        .prose { max-width: none; width: 100%; }
        .prose h1, .prose h2, .prose h3 { font-weight: 800; color: #0f172a; margin-top: 4rem; margin-bottom: 2rem; text-align: left; letter-spacing: -0.03em; }
        .prose p { margin-bottom: 2.2rem; line-height: 2.3; color: #2c3e50; text-align: justify; font-size: 1.18rem; }
        .prose strong { color: #000; font-weight: 800; border-bottom: 2px solid #3b82f633; }
        .prose ul, .prose ol { margin-bottom: 3rem; width: 100%; padding: 0; }
        .prose li { margin-bottom: 1.8rem; color: #2c3e50; text-align: justify; list-style: none; position: relative; padding-left: 2.8rem; font-size: 1.18rem; line-height: 2.1; }
        .prose li::before { content: "▸"; position: absolute; left: 0; color: #3b82f6; font-size: 1.4rem; top: -0.1rem; font-weight: 900; }

        #login-screen, #app-content { display: none; }

        .elite-input {
            border: none;
            background: #F8FAFF;
            border-radius: 1.8rem;
            padding: 2rem 2.5rem;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.02);
            font-weight: 600;
            font-size: 1.15rem;
        }
        .elite-input:focus {
            outline: none;
            background: #ffffff;
            box-shadow: 0 25px 50px -12px rgba(59, 130, 246, 0.15);
            transform: translateY(-4px);
        }

        .pdf-page { padding: 80px; background: white; color: #1e293b; font-family: 'Plus Jakarta Sans', sans-serif; }
    </style>
</head>
<body class="text-slate-900 selection:bg-blue-600 selection:text-white">

    <!-- LOGIN SCREEN -->
    <div id="login-screen" class="min-h-screen flex items-center justify-center p-8 bg-slate-950 relative overflow-hidden">
        <div class="absolute -top-64 -left-64 w-[70rem] h-[70rem] bg-blue-600/10 rounded-full blur-[220px]"></div>
        <div class="absolute -bottom-64 -right-64 w-[70rem] h-[70rem] bg-indigo-600/10 rounded-full blur-[220px]"></div>

        <div class="w-full max-w-sm relative z-10 animate-in text-center">
            <div class="mb-20">
                <div class="inline-flex p-6 bg-white/5 backdrop-blur-3xl rounded-[2.8rem] border border-white/10 mb-10 shadow-2xl">
                    <i data-lucide="book-open" class="w-14 h-14 text-blue-400"></i>
                </div>
                <h2 class="text-5xl font-black text-white tracking-tighter uppercase mb-2 leading-none">Elite<span class="text-blue-500 font-light">Seller</span></h2>
                <p class="text-slate-500 text-[11px] font-black uppercase tracking-[0.6em] opacity-80">The Seller's Handbook</p>
            </div>

            <div class="space-y-6 text-left">
                <div class="space-y-2">
                    <label class="block text-[10px] font-black uppercase tracking-widest text-slate-500 ml-4">Credentials</label>
                    <!-- autocomplete="off" untuk mematikan saran browser -->
                    <input type="email" id="login-email" placeholder="Email Kerja" autocomplete="off" class="w-full px-8 py-6 bg-white/5 border border-white/10 rounded-[2.2rem] text-white focus:outline-none focus:border-blue-500 transition-all font-semibold placeholder:text-slate-700 shadow-inner" />
                </div>
                <div class="space-y-2">
                    <label class="block text-[10px] font-black uppercase tracking-widest text-slate-500 ml-4">Access Code</label>
                    <!-- autocomplete="new-password" paling efektif mematikan auto-fill password -->
                    <input type="password" id="login-password" placeholder="••••••••" autocomplete="new-password" class="w-full px-8 py-6 bg-white/5 border border-white/10 rounded-[2.2rem] text-white focus:outline-none focus:border-blue-500 transition-all font-semibold shadow-inner" />
                </div>
                
                <button onclick="handleLogin()" id="btn-login-action" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-black py-7 rounded-[2.2rem] transition-all shadow-2xl shadow-blue-600/30 flex items-center justify-center gap-4 active:scale-95 group mt-8">
                    <span class="uppercase tracking-widest text-xs">Unlock Handbook</span>
                    <i data-lucide="key" class="w-5 h-5 group-hover:rotate-45 transition-transform"></i>
                </button>
                <div id="login-error" class="text-rose-400 text-[10px] font-black text-center mt-6 hidden uppercase tracking-widest bg-rose-400/5 p-6 rounded-3xl border border-rose-400/10"></div>
            </div>
        </div>
    </div>

    <!-- MAIN APP CONTENT -->
    <div id="app-content">
        <!-- HEADER LUXURY -->
        <header class="sticky top-0 z-50 bg-white/95 backdrop-blur-3xl border-b border-slate-100">
            <div class="max-w-7xl mx-auto px-8">
                <div class="flex items-center justify-between h-32">
                    <div class="flex items-center gap-5 group cursor-pointer" onclick="location.reload()">
                        <div class="bg-slate-900 p-4 rounded-2xl shadow-2xl transition-all group-hover:bg-blue-600">
                            <i data-lucide="book-marked" class="w-7 h-7 text-white"></i>
                        </div>
                        <div class="flex flex-col">
                            <h1 class="text-3xl font-black text-slate-900 tracking-tighter uppercase leading-none">Elite<span class="text-blue-600 font-light">Seller</span></h1>
                            <span class="text-[9px] font-black text-slate-400 uppercase tracking-[0.6em] mt-1">Handbook v3.0</span>
                        </div>
                    </div>
                    
                    <div class="flex items-center gap-4">
                        <div id="api-badge" class="hidden md:flex items-center gap-3 px-6 py-3 bg-emerald-50 text-emerald-600 rounded-full border border-emerald-100 text-[10px] font-black uppercase tracking-widest mr-4">
                            <div id="status-dot" class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></div>
                            <span id="status-text">Intelligence Online</span>
                        </div>
                        <button onclick="toggleApiSettings()" class="p-4 text-slate-400 hover:text-blue-600 transition-all rounded-[1.2rem] hover:bg-blue-50" title="System Protocol">
                            <i data-lucide="database" class="w-6 h-6"></i>
                        </button>
                        <button onclick="handleLogout()" class="p-4 text-rose-500 hover:bg-rose-50 rounded-[1.2rem] transition-all" title="Terminate Session">
                            <i data-lucide="log-out" class="w-6 h-6"></i>
                        </button>
                    </div>
                </div>

                <nav id="feature-nav" class="flex items-center gap-2 overflow-x-auto no-scrollbar pb-6 -mx-2">
                    <!-- Tabs Injected -->
                </nav>
            </div>
        </header>

        <!-- MAIN -->
        <main class="max-w-4xl mx-auto px-8 py-24">
            <div id="api-warning" class="hidden mb-20 animate-in">
                <div class="bg-blue-50 border-2 border-blue-100 rounded-[3.5rem] p-14 text-center shadow-xl">
                    <h4 class="text-3xl font-black text-blue-900 mb-4 uppercase tracking-tighter">Sistem Belum Terhubung</h4>
                    <p class="text-blue-600/80 mb-12 font-semibold leading-relaxed text-xl max-w-2xl mx-auto text-justify sm:text-center">Handbook ini memerlukan API Key Google AI Studio Anda untuk mensinkronisasi data pasar global ke dalam strategi lokal toko Anda.</p>
                    <button onclick="toggleApiSettings()" class="bg-blue-600 text-white font-black px-14 py-6 rounded-[2.5rem] text-[11px] uppercase tracking-[0.3em] shadow-2xl shadow-blue-600/30 active:scale-95 transition-all">Hubungkan Kunci AI</button>
                </div>
            </div>

            <!-- HERO SECTION -->
            <div class="mb-40 animate-in text-center sm:text-left">
                <div class="inline-flex items-center gap-3 px-6 py-2.5 bg-blue-50 text-blue-700 rounded-full text-[10px] font-black uppercase tracking-[0.4em] mb-12 border border-blue-100 mx-auto sm:mx-0 shadow-sm">
                    <i data-lucide="terminal" class="w-4 h-4 text-blue-600"></i>
                    The Seller's Handbook Engine
                </div>
                <h2 id="feature-title" class="text-7xl md:text-9xl font-black text-slate-900 mb-10 tracking-tighter leading-none">Riset.</h2>
                <p id="feature-role-desc" class="text-slate-500 text-3xl font-medium leading-relaxed max-w-3xl">Lengkapi variabel data Anda untuk mendapatkan instruksi kerja tingkat pakar yang sangat detail dan aplikatif.</p>
            </div>

            <!-- FORM NARRATIVE FLOW -->
            <section class="mb-64 animate-in">
                <div id="dynamic-fields" class="space-y-20">
                    <!-- Premium Stacked Inputs -->
                </div>
                <div class="mt-32">
                    <button id="btn-generate" onclick="handleGenerate()" class="group flex items-center justify-center gap-8 bg-slate-900 hover:bg-blue-600 text-white font-black py-9 px-20 rounded-[2.8rem] transition-all duration-700 shadow-2xl active:scale-95 w-full">
                        <span id="btn-text" class="tracking-[0.4em] uppercase text-[12px]">Tulis Bab Strategi Saya</span>
                        <i data-lucide="wand-2" class="w-8 h-8 group-hover:scale-125 transition-transform text-white"></i>
                    </button>
                </div>
            </section>

            <!-- RESULTS SECTION -->
            <div id="result-container" class="hidden animate-in scroll-mt-32 pb-40">
                <div class="flex items-center gap-10 mb-32 opacity-20">
                    <div class="h-px flex-1 bg-slate-900"></div>
                    <span class="text-[12px] font-black uppercase tracking-[1.5em] text-center ml-8">Handbook Chapter Manuscript</span>
                    <div class="h-px flex-1 bg-slate-900"></div>
                </div>

                <div id="loading-state" class="hidden text-center py-20">
                    <div class="inline-block animate-spin mb-12 text-blue-600">
                        <i data-lucide="settings-2" class="w-16 h-16"></i>
                    </div>
                    <h4 class="text-4xl font-black tracking-tight text-slate-900 uppercase">Menyusun Naskah Strategi...</h4>
                    <p class="text-slate-400 mt-6 font-bold uppercase tracking-widest text-sm text-justify sm:text-center">Mengintegrasikan ribuan jam riset mentor ke dalam variabel bisnis Anda</p>
                </div>

                <div id="result-card" class="bg-white">
                    <div id="ai-output" class="prose prose-slate mb-32">
                        <!-- Pure narrative manuscript -->
                    </div>
                    <div class="flex flex-col sm:flex-row justify-between items-center gap-14 pt-24 border-t border-slate-100">
                        <div class="flex items-center gap-8 text-left">
                            <div class="w-20 h-20 bg-emerald-500 rounded-[2.2rem] flex items-center justify-center shadow-2xl shadow-emerald-500/30">
                                <i data-lucide="check" class="w-10 h-10 text-white"></i>
                            </div>
                            <div>
                                <p class="text-[11px] font-black uppercase tracking-[0.5em] text-slate-400 leading-none mb-3">Status Dokumen</p>
                                <p class="text-2xl font-black uppercase text-slate-900 leading-none tracking-tight">Siap Dipraktikkan</p>
                            </div>
                        </div>
                        <button onclick="exportToPDF()" class="flex items-center gap-5 bg-slate-900 hover:bg-blue-600 text-white font-black px-16 py-7 rounded-[2.5rem] text-[12px] uppercase tracking-widest transition-all shadow-2xl active:scale-95">
                            <i data-lucide="download" class="w-7 h-7"></i> Simpan Handbook PDF
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- API CONFIG MODAL -->
    <div id="api-settings-panel" class="hidden fixed inset-0 z-[60] flex items-center justify-center p-8">
        <div class="absolute inset-0 bg-white/95 backdrop-blur-2xl" onclick="toggleApiSettings()"></div>
        <div class="w-full max-w-lg relative animate-in text-center">
            <button onclick="toggleApiSettings()" class="absolute -top-24 right-0 text-slate-300 hover:text-black transition-all">
                <i data-lucide="x-circle" class="w-12 h-12"></i>
            </button>
            <h3 class="text-5xl font-black mb-8 tracking-tighter uppercase leading-none">Aktivasi<br><span class="text-blue-600">Intelijen</span></h3>
            <p class="text-slate-500 text-xl mb-20 font-medium leading-relaxed max-w-sm mx-auto text-justify sm:text-center">Sinkronisasikan Handbook Anda dengan server Google AI Studio secara aman untuk akses penuh.</p>
            
            <div class="space-y-16">
                <div class="space-y-5 text-left">
                    <label class="block text-[12px] font-black uppercase tracking-[0.4em] text-slate-400 ml-6">AI Studio API Key</label>
                    <input type="password" id="api-key-input" placeholder="Tempel kunci rahasia Anda..." class="elite-input w-full font-mono text-base shadow-2xl" />
                </div>
                <div class="flex flex-col gap-6">
                    <button onclick="verifyAndSaveApiKey()" class="bg-blue-600 text-white font-black py-8 rounded-[2.5rem] uppercase text-xs tracking-[0.4em] hover:bg-blue-700 transition-all shadow-2xl shadow-blue-600/30 active:scale-95" id="btn-save-api">Connect Engine</button>
                    <button onclick="deleteApiKey()" class="text-rose-500 font-black text-[11px] uppercase tracking-[0.4em] hover:text-rose-700 transition-colors">Terminate Key & Erase Cache</button>
                </div>
                <div id="api-validation-msg" class="text-[11px] font-black uppercase hidden p-6 rounded-3xl"></div>
            </div>
        </div>
    </div>

    <script>
        const APP_FEATURES = [
            { id: 1, title: "Riset Produk", role: "E-commerce Architect", prompt: (i) => `Bertindak sebagai E-commerce Architect profesional. Rekomendasikan minimal 30 ide produk fisik/digital unik untuk dijual di ${i.marketplace} dalam niche ${i.niche}. UNTUK SETIAP PRODUK: Wajib memberikan analisis psikologi kenapa barang ini diinginkan, rincian varian produk yang wajib ada, estimasi margin keuntungan per unit, dan PROFIL TARGET PEMBELI YANG SANGAT DETAIL. Jelaskan dalam format narasi panjang seperti bab sebuah buku strategi mahal. JANGAN GUNAKAN GARIS PEMBATAS APAPUN.`, fields: [{ id: 'marketplace', label: 'Nama Marketplace', placeholder: 'Ketik platform (Shopee, TikTok, dll)...' }, { id: 'niche', label: 'Niche Bisnis', placeholder: 'Ketik kategori produk Anda...' }] },
            { id: 19, title: "Convergence Lab", role: "Brand Innovation Architect", prompt: (i) => `Bertindak sebagai Brand Innovation Architect profesional. Gunakan teknik 'Convergence' untuk menciptakan produk unik bagi brand di niche ${i.niche} yang dijual di ${i.marketplace}. TEKNIK: Ambil niche utama pembeli, lalu tabrakkan dengan konsep dari dunia lain yang tidak berhubungan (misal: Skincare + Cloud Computing, atau Baju Anak + Gamifikasi). WAJIB MEMBERIKAN 10 CONTOH KONKRIT produk hasil konvergensi yang bisa bikin brand stand out dan memonopoli pasar. Jelaskan secara naratif panjang, inspiratif, dan JANGAN GUNAKAN GARIS PEMBATAS APAPUN.`, fields: [{ id: 'marketplace', label: 'Nama Marketplace', placeholder: 'Shopee, TikTok Shop, dll...' }, { id: 'niche', label: 'Niche Bisnis Utama', placeholder: 'Apa niche jualan Anda sekarang?' }] },
            { id: 18, title: "Recency Frame", role: "Persuasion Psychologist", prompt: (i) => `Bertindak sebagai Persuasion Psychologist. Gunakan teknik 'Recency Effect' untuk menyusun kalimat penawaran maut bagi ${i.productName} di ${i.marketplace}. TEKNIK: Mulailah narasi dengan 'Kejujuran Pahit' (kelemahan kecil, biaya, atau usaha yang diperlukan pembeli), lalu tutup dengan 'Kemenangan Manis' (manfaat utama, hasil akhir, atau kepuasan emosional). Ingat: Otak manusia mengingat apa yang didengar terakhir. WAJIB MEMBERIKAN 10 CONTOH KONKRIT perbandingan kalimat 'Sebelum vs Sesudah Optimasi Recency'. Tulis dalam narasi panjang tanpa garis pembatas.`, fields: [{ id: 'marketplace', label: 'Nama Marketplace', placeholder: 'Shopee, TikTok Shop, dll...' }, { id: 'productName', label: 'Nama Produk', placeholder: 'Produk apa yang ingin dirayu ke pembelinya?' }] },
            { id: 17, title: "Neuromarketing", role: "Neuromarketing Expert", prompt: (i) => `Bertindak sebagai Neuromarketing Expert profesional. Bantu saya memanipulasi mata dan pikiran calon pembeli untuk ${i.productName} di ${i.marketplace}. WAJIB MENERAPKAN 3 TEKNIK: 1. The Rule of Three (buatkan simulasi 3 pilihan harga konkrit), 2. Contrast Effect (jelaskan produk apa yang harus diletakkan di samping produk kita agar terlihat murah), 3. Anchoring Bias (buatkan simulasi harga jangkar yang tinggi sebelum penawaran akhir). Berikan narasi panjang yang inspiratif dan JANGAN GUNAKAN GARIS PEMBATAS APAPUN.`, fields: [{ id: 'marketplace', label: 'Nama Marketplace', placeholder: 'Shopee, TikTok Shop, dll...' }, { id: 'productName', label: 'Nama Produk', placeholder: 'Produk apa yang ingin di-hack harganya?' }] },
            { id: 2, title: "Copywriting", role: "Conversion Psychologist", prompt: (i) => `Bertindak sebagai Psikolog Konversi dan Copywriter Elit. Tuliskan naskah deskripsi produk untuk ${i.productName} di ${i.marketplace}. WAJIB MEMBERIKAN 10 PILIHAN CONTOH KONKRIT kalimat pembuka yang emosional. Pastikan narasi panjang, rapi, rata kiri-kanan, dan JANGAN PAKAI GARIS PUTUS-PUTUS.`, fields: [{ id: 'marketplace', label: 'Platform Marketplace', placeholder: 'Ketik nama marketplace...' }, { id: 'productName', label: 'Nama Produk Detail', placeholder: 'Ketik rincian nama produk Anda...' }] },
            { id: 3, title: "Harga", role: "Profit Engineer", prompt: (i) => `Bertindak sebagai Profit Engineer. Tentukan strategi harga untuk ${i.productName} dengan biaya modal Rp ${i.cost} dan harga kompetitor Rp ${i.compPrice}. WAJIB MEMBERIKAN CONTOH KONKRIT simulasi kenaikan omzet menggunakan sistem harga psikologis. JANGAN PAKAI GARIS PEMBATAS.`, fields: [{ id: 'productName', label: 'Nama Produk', placeholder: 'Nama produk Anda...' }, { id: 'cost', label: 'Modal Per Unit (Rp)', placeholder: 'Ketik nominal modal...' }, { id: 'compPrice', label: 'Harga Saingan (Rp)', placeholder: 'Ketik nominal saingan...' }] },
            { id: 4, title: "Iklan", role: "Algorithm Hacker", prompt: (i) => `Bertindak sebagai Algorithm Hacker. Rancang strategi kampanye iklan untuk ${i.productName}. WAJIB MEMBERIKAN CONTOH KONKRIT struktur set iklan, daftar 30 kata kunci pencarian, dan setting audiens. Tulis dalam narasi panjang tanpa garis.`, fields: [{ id: 'marketplace', label: 'Platform Iklan', placeholder: 'Shopee Ads, TikTok Ads, dll...' }, { id: 'productName', label: 'Produk Iklan', placeholder: 'Nama produk...' }] },
            { id: 13, title: "Ritual Harian", role: "Operations Master", prompt: (i) => `Bertindak sebagai Operations Master. Tuliskan naskah panduan harian (SOP) untuk admin toko di ${i.marketplace}. WAJIB MEMBERIKAN CONTOH KONKRIT checklist per jam (Pagi, Siang, Malam). JANGAN PAKAI GARIS PEMBATAS.`, fields: [{ id: 'marketplace', label: 'Platform Marketplace', placeholder: 'Shopee, Tokopedia, dll...' }] },
            { id: 14, title: "Script Live", role: "Live Streaming Guru", prompt: (i) => `Bertindak sebagai Guru Live Streaming. Buatkan skrip naratif panjang untuk sesi Live ${i.platform} jualan ${i.productName}. WAJIB MEMBERIKAN CONTOH KONKRIT kata-kata pembuka yang menahan penonton. Narasi panjang tanpa garis.`, fields: [{ id: 'productName', label: 'Produk untuk Live', placeholder: 'Nama produk...' }, { id: 'platform', label: 'Platform Live', placeholder: 'TikTok Live, Shopee Live...' }] },
            { id: 16, title: "Komplain", role: "PR & Reputation Expert", prompt: (i) => `Bertindak sebagai Ahli Reputasi & PR. Buatkan panduan menghadapi komplain ${i.issue}. WAJIB MEMBERIKAN 5 CONTOH KONKRIT template kalimat chat. Tulis secara naratif panjang. JANGAN PAKAI GARIS PUTUS-PUTUS.`, fields: [{ id: 'issue', label: 'Masalah Utama', placeholder: 'Barang pecah, kurang, salah warna...' }] }
        ];

        let userApiKey = localStorage.getItem('jagojualan_api_key') || "";
        let activeTabId = 1;
        let inputs = {};
        let resultText = "";

        // --- AUTH LOGIC ---
        function handleLogin() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const errorDiv = document.getElementById('login-error');
            const btn = document.getElementById('btn-login-action');
            if (!email || !password) return;
            btn.disabled = true;
            btn.innerText = "AUTHENTICATING AUTHORITIES...";
            window.firebaseAuth.signInWithEmailAndPassword(window.firebaseAuth.auth, email, password)
                .catch(() => {
                    errorDiv.innerText = "ACCESS REJECTED: INVALID CREDENTIALS";
                    errorDiv.classList.remove('hidden');
                    btn.disabled = false;
                    btn.innerText = "Unlock Handbook";
                });
        }

        function handleLogout() {
            // SECURITY: Clear sensitive input fields on logout
            const emailInput = document.getElementById('login-email');
            const passInput = document.getElementById('login-password');
            if (emailInput) emailInput.value = "";
            if (passInput) passInput.value = "";
            
            // TERMINATE FIREBASE SESSION
            window.firebaseAuth.signOut(window.firebaseAuth.auth);
        }

        // --- CORE UI ---
        function init() {
            renderTabs();
            renderForm();
            checkApiKey();
            lucide.createIcons();
            import("https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js").then(({ onAuthStateChanged, getAuth }) => {
                onAuthStateChanged(getAuth(), (user) => {
                    if (user) {
                        document.getElementById('login-screen').style.display = 'none';
                        document.getElementById('app-content').style.display = 'block';
                    } else {
                        // SECURITY: Ensure fields are clear when login screen shows
                        const emailInput = document.getElementById('login-email');
                        const passInput = document.getElementById('login-password');
                        if (emailInput) emailInput.value = "";
                        if (passInput) passInput.value = "";

                        document.getElementById('login-screen').style.display = 'flex';
                        document.getElementById('app-content').style.display = 'none';
                    }
                });
            });
        }

        function toggleApiSettings() { document.getElementById('api-settings-panel').classList.toggle('hidden'); }

        async function verifyAndSaveApiKey() {
            const input = document.getElementById('api-key-input').value.trim();
            const msg = document.getElementById('api-validation-msg');
            if (!input) return;
            msg.classList.remove('hidden', 'text-emerald-600', 'text-rose-600');
            msg.innerText = "SINKRONISASI SISTEM...";
            msg.className = "text-[11px] font-black uppercase text-center block mt-6 text-blue-600 tracking-[0.2em]";
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${input}`);
                if (response.ok) {
                    userApiKey = input;
                    localStorage.setItem('jagojualan_api_key', input);
                    msg.innerText = "✓ SYSTEM FULLY OPERATIONAL";
                    msg.classList.add('text-emerald-600');
                    updateStatus(true);
                    setTimeout(() => toggleApiSettings(), 1200);
                } else { throw new Error(); }
            } catch {
                msg.innerText = "⚠ AUTHENTICATION FAILURE";
                msg.classList.add('text-rose-600');
                updateStatus(false);
            }
        }

        function deleteApiKey() {
            userApiKey = "";
            localStorage.removeItem('jagojualan_api_key');
            updateStatus(false);
            toggleApiSettings();
        }

        function updateStatus(isValid) {
            const dot = document.getElementById('status-dot');
            const text = document.getElementById('status-text');
            const warning = document.getElementById('api-warning');
            if (isValid && userApiKey) {
                dot.className = "w-1.5 h-1.5 rounded-full bg-emerald-500 shadow-[0_0_15px_rgba(16,185,129,0.7)] animate-pulse";
                text.innerText = "Intelligence Active";
                text.className = "text-emerald-600 font-black";
                warning.classList.add('hidden');
            } else {
                dot.className = "w-1.5 h-1.5 rounded-full bg-slate-300";
                text.innerText = "Offline";
                text.className = "text-slate-400 font-black";
                warning.classList.remove('hidden');
            }
        }

        function checkApiKey() { updateStatus(!!userApiKey); }

        function renderTabs() {
            const nav = document.getElementById('feature-nav');
            nav.innerHTML = APP_FEATURES.map(f => `
                <button onclick="switchTab(${f.id})" class="text-[11px] font-black uppercase tracking-[0.4em] px-8 py-5 whitespace-nowrap transition-all rounded-[1.8rem] ${activeTabId === f.id ? 'bg-slate-900 text-white shadow-2xl scale-105' : 'text-slate-400 hover:text-slate-900 hover:bg-slate-100'}">
                    ${f.title}
                </button>
            `).join('');
        }

        function switchTab(id) {
            activeTabId = id;
            inputs = {};
            document.getElementById('result-container').classList.add('hidden');
            renderTabs();
            renderForm();
            const f = APP_FEATURES.find(x => x.id === id);
            document.getElementById('feature-title').innerText = `${f.title}.`;
            document.getElementById('feature-role-desc').innerText = `Merumuskan naskah handbook eksklusif bersama asisten ${f.role} profesional Anda.`;
        }

        function renderForm() {
            const f = APP_FEATURES.find(x => x.id === activeTabId);
            document.getElementById('dynamic-fields').innerHTML = f.fields.map(field => `
                <div class="space-y-6 animate-in text-left">
                    <label class="block text-[12px] font-black uppercase tracking-[0.5em] text-slate-400 ml-6">${field.label}</label>
                    <input type="text" oninput="inputs['${field.id}']=this.value" placeholder="${field.placeholder}" class="elite-input w-full" />
                </div>
            `).join('');
        }

        async function handleGenerate() {
            if (!userApiKey) return toggleApiSettings();
            const f = APP_FEATURES.find(x => x.id === activeTabId);
            const resCon = document.getElementById('result-container');
            const loading = document.getElementById('loading-state');
            const resCard = document.getElementById('result-card');
            const output = document.getElementById('ai-output');
            
            resCon.classList.remove('hidden');
            loading.classList.remove('hidden');
            resCard.classList.add('hidden');
            
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${userApiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: f.prompt(inputs) }] }],
                        systemInstruction: { parts: [{ text: `Jawab dalam bahasa Indonesia profesional yang sangat kaya akan narasi dan inspirasi nyata. Anda adalah pakar e-commerce level dunia. WAJIB MEMBERIKAN BANYAK CONTOH KONKRIT (perbandingan kalimat promosi nyata, simulasi harga nyata, dsb) di setiap rincian. Format harus murni naskah narasi panjang (handbook chapter). JANGAN GUNAKAN GARIS PUTUS-PUTUS (---), simbol pembatas markdown (===), atau dekorasi karakter kasar. Seluruh teks harus sangat rapi, rata kiri-kanan (justify), dan menginspirasi pikiran tingkat eksekutif.` }] }
                    })
                });
                const data = await response.json();
                resultText = data.candidates[0].content.parts[0].text;
                output.innerHTML = formatText(resultText);
                loading.classList.add('hidden');
                resCard.classList.remove('hidden');
                setTimeout(() => resCon.scrollIntoView({ behavior: 'smooth' }), 100);
            } catch {
                output.innerHTML = "<p class='text-center uppercase font-black py-20 text-rose-600 tracking-[1em]'>System Synchronization Failure.</p>";
                loading.classList.add('hidden');
                resCard.classList.remove('hidden');
            }
        }

        function formatText(t) {
            // Pembersihan total pembatas visual
            let clean = t.replace(/^-{3,}$/gm, '')
                         .replace(/^={3,}$/gm, '')
                         .replace(/^_{3,}$/gm, '')
                         .replace(/^\s*[\-\*]{3,}\s*$/gm, '');

            return clean.replace(/^### (.*$)/gim, '<h3 class="text-4xl font-black uppercase tracking-tight mb-10 mt-32 text-slate-900">$1</h3>')
                    .replace(/^## (.*$)/gim, '<h2 class="text-5xl font-black uppercase tracking-tighter mb-14 mt-40 text-blue-600">$1</h2>')
                    .replace(/\*\*(.*)\*\*/gim, '<strong class="font-black text-black">$1</strong>')
                    .replace(/^\* (.*$)/gim, '<li>$1</li>')
                    .replace(/^\- (.*$)/gim, '<li>$1</li>')
                    .replace(/\n\n/g, '</p><p class="text-justify leading-[2.3] mb-14">')
                    .replace(/\n/g, '<br>')
                    .replace(/(<p>|^)/g, '$1<p class="text-justify leading-[2.3] text-slate-800 mb-14">')
                    .replace(/(<\/p>|$)/g, '</p>');
        }

        function exportToPDF() {
            const element = document.getElementById('ai-output');
            const feature = APP_FEATURES.find(x => x.id === activeTabId);
            const wrapper = document.createElement('div');
            wrapper.className = 'pdf-page';
            wrapper.innerHTML = `<h1 style="text-align: center; text-transform: uppercase; font-weight: 900; margin-bottom: 70px; border-bottom: 6px solid #3b82f6; padding-bottom: 40px; font-size: 36px; letter-spacing: -2px;">The Elite Seller Strategy Manuscript</h1>` + element.innerHTML;
            const opt = { margin: [1, 1], filename: `Elite_Handbook_${feature.title}.pdf`, image: { type: 'jpeg', quality: 1 }, html2canvas: { scale: 3, letterRendering: true }, jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' } };
            html2pdf().set(opt).from(wrapper).save();
        }
        window.onload = init;
    </script>
</body>
</html>